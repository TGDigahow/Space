import flet as ft
import speech_recognition as sr

def main(page: ft.Page):
    page.title = "Free Way"
    page.vertical_alignment = ft.MainAxisAlignment.START
    page.horizontal_alignment = ft.CrossAxisAlignment.CENTER

    # Logomarca
    logo = ft.Image(src="A:/Free-Way-LOGO.png", width=150, height=150)

    # Opções de destinos
    options = ft.Dropdown(
        label="Selecione uma opção",
        options=[
            ft.dropdown.Option("Biblioteca"),
            ft.dropdown.Option("Financeiro"),
            ft.dropdown.Option("Secretaria"),
            ft.dropdown.Option("Sala 2.3"),
        ]
    )

    # Acessibilidade
    accessibility_switch = ft.Switch(label="Acessibilidade", value=False)

    miniplayer_container = ft.Container()

    # Função para ativar comando de voz
    def ativar_comando_voz():
        recognizer = sr.Recognizer()
        with sr.Microphone() as source:
            print("Perguntando ao usuário: 'Deseja rota com acessibilidade?'")
            audio = recognizer.listen(source)
        
        try:
            resposta = recognizer.recognize_google(audio, language="pt-BR").lower()
            if "sim" in resposta:
                accessibility_switch.value = True
            elif "não" in resposta:
                accessibility_switch.value = False
            else:
                print("Resposta não reconhecida, mantendo o valor atual.")
        except sr.UnknownValueError:
            print("Não foi possível entender a resposta.")
        except sr.RequestError:
            print("Erro ao tentar acessar o serviço de reconhecimento de voz.")
        
        page.update()

    # Carregar rota baseada nas seleções
    def carregar_rota(e):
        selected_option = options.value
        accessibility = "com acessibilidade" if accessibility_switch.value else "sem acessibilidade"
        
        # Caminho das imagens baseado na opção e acessibilidade
        image_src = ""
        if selected_option == "Biblioteca":
            image_src = "A:/mapa2.gif" if accessibility_switch.value else "A:/mapa6.gif"
        elif selected_option == "Financeiro":
            image_src = "A:/mapa3.gif" if accessibility_switch.value else "A:/mapa7.gif"
        elif selected_option == "Secretaria":
            image_src = "A:/mapa1.png" if accessibility_switch.value else "A:/mapappagaio.gif"
        elif selected_option == "Sala 2.3":
            image_src = "A:/mapa5.gif" if accessibility_switch.value else "A:/escada.gif"

        # Exibindo o conteúdo da rota selecionada
        miniplayer_container.content = ft.Column([
            ft.Text(f"Destino: {selected_option} ({accessibility})"),
            ft.Image(src=image_src, width=300, height=200),
        ])
        page.update()

    # Botão para ativar o comando de voz
    voz_button = ft.ElevatedButton(text="Ativar Comando de Voz", on_click=lambda _: ativar_comando_voz())
    
    # Botão para carregar rota
    carregar_rota_button = ft.ElevatedButton(text="Carregar Rota", on_click=carregar_rota)

    # Componentes da página
    page.add(
        logo,
        options,
        accessibility_switch,
        voz_button,
        carregar_rota_button,
        miniplayer_container  
    )

ft.app(target=main)
